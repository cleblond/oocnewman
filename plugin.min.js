tinymce.PluginManager.add('oocnewman', function(editor, url) {
  // Add a button that opens a chemdoodle window

  var subfolderdiv = document.getElementById("subfolder");
  var subfolder = subfolderdiv.getAttribute("data-subfolder");
    var ajaxurldiv = document.getElementById("ajaxurl");
    var ajaxurl = ajaxurldiv.getAttribute("data-ajaxurl");


  editor.addButton('oocnewman', {
    //text: 'Newman Projections',
    tooltip: 'Insert a Newman Projection',
    image: url + '/newman_icon.png',
    onclick: function() {
      // Open window
      var win = editor.windowManager.open({
        title: 'Insert/Draw a Newman Projection',
		file : url + '/dialog.html',

		width: 800,
        height: 500/*,
        onsubmit: function(e) {

        },
        
        buttons: [
                    {
                        text: 'Insert',
                        onclick: function(e) {
                        

                              console.log(tinymce.activeEditor.dom.getElementById('projectionCanvas'));
                            //function handleClick(e) {
                              //const targetElement = e.target;
                              //const documentObject = targetElement.closest('html').ownerDocument;
                              //console.log(document.);
                              
                              // Now you have access to the document object
                              //console.log(documentObject.getElementById('projectionCanvas'));

                              const parentWindow = window.parent;

                              // Access the parent document
                              const parentDocument = parentWindow.document;

                              // Find the desired element (e.g., by ID)
                              const canvas = parentDocument.getElementById('projectionCanvas');





                            //console.log(editor.windowManager.windows[0]);
                            // Access the iframe document inside the popup
                            //console.log(this.parent().parent().getEl());
                            
                            //var winBody = this.parent().parent().document();
                            //var canvas = winBody.getElementById('projectionCanvas');
                            //var canvas = winBody.querySelector('#projectionCanvas');
                            
                            if (canvas) {
                                var dataUrl = canvas.toDataURL();
                                editor.insertContent('<img src="' + dataUrl + '" />');
                                editor.windowManager.close();
                            } else {
                                console.error('projectionCanvas not found');
                            }
                                //editor.insertContent('<img src="' + dataUrl + '" />');
                                //editor.windowManager.close();
                                //top.tinymce.activeEditor.windowManager.close();
                        }
                    },
                    {
                        text: 'Close',
                        onclick: 'close'
                    }
                ]*/
        
        
        
      },{folder: subfolder, url: ajaxurl});
    }
  });


});
